<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Carta Digital ‚Ä¢ Demo Intermedio (funcional)</title>
  <meta name="description" content="Carta digital con im√°genes, carrito y pedido por WhatsApp. Plan Intermedio funcional.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{
      --bg:#0e0f10;           /* negro suave */
      --panel:#141518;        /* paneles */
      --panel-2:#1a1c20;      /* paneles secundarios */
      --text:#ffffff;         /* texto principal */
      --muted:#cfd5df;        /* texto suave */
      --brand:#0ea5e9;        /* azul botones */
      --accent:#ffd60a;       /* amarillo t√≠tulos */
      --border:rgba(255,255,255,.10);
      --shadow:0 10px 30px rgba(0,0,0,.45);
    }
    body{ font-family:'Inter',system-ui; background:var(--bg); color:var(--text); }
    .title-yellow{ color:var(--accent); text-shadow:0 2px 20px rgba(255,214,10,.18); }
    .muted{ color:var(--muted); }
    .panel{ background:var(--panel); border:1px solid var(--border); }
    .card{ border:1px solid var(--border); border-radius:16px; overflow:hidden; background:#0b0c0e; }

    .btn{ display:inline-flex; align-items:center; justify-content:center; padding:.6rem 1rem; border-radius:12px; font-weight:800; background:var(--brand); color:#fff; box-shadow:0 6px 16px rgba(14,165,233,.35);}
    .btn:active{ transform:translateY(1px); }
    .btn-outline{ display:inline-flex; align-items:center; justify-content:center; padding:.5rem .9rem; border-radius:12px; font-weight:700; border:2px solid var(--brand); color:var(--brand); background:transparent;}

    .pill{ white-space:nowrap; padding:.5rem .75rem; border-radius:999px; border:1px solid var(--border); color:var(--muted); background:#0e0f10; }
    .pill.active{ background:var(--panel-2); color:#fff; border-color:rgba(255,214,10,.35); box-shadow:inset 0 0 0 1px rgba(255,214,10,.2); }

    .img-grad::after{ content:""; position:absolute; inset:0; background:linear-gradient(to top, rgba(0,0,0,.55), rgba(0,0,0,0)); }
    .badge{ font-size:.75rem; font-weight:700; padding:.25rem .5rem; border-radius:999px; background:rgba(0,0,0,.55); color:#fff; border:1px solid var(--border); backdrop-filter:blur(4px); }

    dialog{ background:var(--panel); color:var(--text); border:1px solid var(--border); border-radius:16px; }
    dialog::backdrop{ background:rgba(0,0,0,.55); }
    .optchip{ border:1.5px solid var(--border); border-radius:999px; padding:.45rem .7rem; cursor:pointer; color:var(--muted); background:transparent; }
    .optchip.active{ border-color:var(--brand); color:#cbeaff; background:#06212b; font-weight:700;}

    .sticky-nav{ background:rgba(14,15,16,.8); border-bottom:1px solid var(--border); backdrop-filter:blur(6px); }
    .sticky-cart-shadow{ box-shadow:var(--shadow); }
    .divider{ border-top:1px solid var(--border); }

    /* LOGO HERO grande con bordes difuminados */
    .logo-hero{
      display:flex; align-items:center; justify-content:center;
      height:200px; position:relative; overflow:hidden;
      background: radial-gradient(1200px 200px at 50% 100%, rgba(255,214,10,.06), transparent 60%);
      border-bottom:1px solid var(--border);
    }
    .logo-hero img{
      max-width:min(75vw, 520px); height:auto;
      filter: drop-shadow(0 14px 28px rgba(0,0,0,.45));
      /* suavizar bordes del logo con m√°scara radial */
      -webkit-mask-image: radial-gradient(closest-side, #000 70%, transparent 100%);
              mask-image: radial-gradient(closest-side, #000 70%, transparent 100%);
    }
  </style>
</head>
<body>

  <!-- NAV SUPERIOR -->
  <nav class="sticky top-0 z-50 sticky-nav">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <img src="img/logo-demo.jpeg" alt="Demo Logo" class="h-9 w-auto rounded">
        <span class="font-extrabold">Carta Demo</span>
      </div>
      <div class="hidden sm:flex items-center gap-2">
        <a href="#carta" class="pill">Carta</a>
        <a href="#como-funciona" class="pill">C√≥mo funciona</a>
        <a href="#contacto" class="pill">Contacto</a>
      </div>
    </div>
  </nav>

  <!-- LOGO GRANDE EN LA PARTE SUPERIOR -->
  <header class="logo-hero">
    <img src="img/logo-demo.jpeg" alt="Logo del restaurante (demo)">
  </header>

  <!-- NAV DE CATEGOR√çAS (opcional) -->
  <nav class="sticky top-[56px] z-40" style="background:rgba(14,15,16,.86); border-bottom:1px solid var(--border);">
    <div class="max-w-6xl mx-auto px-4 py-2">
      <div class="flex items-center gap-2 overflow-x-auto">
        <button data-cat="todo" class="pill active">Todo</button>
        <button data-cat="burgers" class="pill">Burgers</button>
        <button data-cat="pizzas" class="pill">Pizzas</button>
        <button data-cat="milanesas" class="pill">Milanesas</button>
        <button data-cat="sides" class="pill">Acompa√±amientos</button>
        <button data-cat="bebidas" class="pill">Bebidas</button>
        <button data-cat="postres" class="pill">Postres</button>
      </div>
    </div>
  </nav>

  <!-- CARTA -->
  <main id="carta" class="max-w-6xl mx-auto px-4 py-6">
    <h1 class="text-3xl sm:text-4xl font-extrabold title-yellow mb-4">Carta Digital ‚Äì Plan Intermedio</h1>
    <p class="muted">Explor√° la carta, configur√° tu pedido y envi√° por WhatsApp. Esta demo muestra exactamente c√≥mo funciona.</p>

    <section id="grid" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3 mt-6">

      <!-- Burger Doble -->
      <article class="group card data-[hidden=true]:hidden" data-category="burgers" data-id="b1">
        <div class="relative h-60 sm:h-64">
          <img src="img/hamburguesa-demo.jpeg" alt="Hamburguesa doble con cheddar y bacon" class="w-full h-full object-cover">
          <div class="absolute top-3 left-3 flex gap-2"><span class="badge">‚≠ê Top ventas</span><span class="badge">üçî</span></div>
          <div class="img-grad absolute inset-0"></div>
          <div class="absolute bottom-3 left-3 right-3">
            <h3 class="text-xl font-extrabold title-yellow">Burger Doble Bacon</h3>
            <p class="muted text-sm">Doble carne, cheddar, bacon, lechuga, tomate</p>
            <div class="mt-2 flex items-center justify-between">
              <span class="text-lg font-bold text-white">$5.200</span>
              <button class="btn !py-2 !px-3 text-sm" data-config="b1">Configurar</button>
            </div>
          </div>
        </div>
      </article>

      <!-- Pizza -->
      <article class="group card data-[hidden=true]:hidden" data-category="pizzas" data-id="p1">
        <div class="relative h-60 sm:h-64">
          <img src="img/pizza-demo.jpeg" alt="Pizza muzzarella" class="w-full h-full object-cover">
          <div class="absolute top-3 left-3 flex gap-2"><span class="badge">üî• Promoci√≥n</span></div>
          <div class="img-grad absolute inset-0"></div>
          <div class="absolute bottom-3 left-3 right-3">
            <h3 class="text-xl font-extrabold title-yellow">Pizza Muzzarella</h3>
            <p class="muted text-sm">Salsa de tomate, muzza, or√©gano</p>
            <div class="mt-2 flex items-center justify-between">
              <span class="text-lg font-bold text-white">$6.000</span>
              <button class="btn !py-2 !px-3 text-sm" data-config="p1">Configurar</button>
            </div>
          </div>
        </div>
      </article>

      <!-- Milanesa Napolitana -->
      <article class="group card data-[hidden=true]:hidden" data-category="milanesas" data-id="m1">
        <div class="relative h-60 sm:h-64">
          <img src="img/milanesa-demo.jpeg" alt="Milanesa napolitana" class="w-full h-full object-cover">
          <div class="absolute top-3 left-3 flex gap-2"><span class="badge">üçΩÔ∏è Cl√°sico</span></div>
          <div class="img-grad absolute inset-0"></div>
          <div class="absolute bottom-3 left-3 right-3">
            <h3 class="text-xl font-extrabold title-yellow">Milanesa Napolitana</h3>
            <p class="muted text-sm">Milanesa con salsa, muzza y jam√≥n</p>
            <div class="mt-2 flex items-center justify-between">
              <span class="text-lg font-bold text-white">$6.800</span>
              <button class="btn !py-2 !px-3 text-sm" data-config="m1">Configurar</button>
            </div>
          </div>
        </div>
      </article>

      <!-- Papas -->
      <article class="group card data-[hidden=true]:hidden" data-category="sides" data-id="s1">
        <div class="relative h-60 sm:h-64">
          <img src="img/papas-demo.jpeg" alt="Papas con cheddar" class="w-full h-full object-cover">
          <div class="img-grad absolute inset-0"></div>
          <div class="absolute bottom-3 left-3 right-3">
            <h3 class="text-xl font-extrabold title-yellow">Papas Cheddar</h3>
            <p class="muted text-sm">Crocantes con cheddar y verdeo</p>
            <div class="mt-2 flex items-center justify-between">
              <span class="text-lg font-bold text-white">$3.400</span>
              <button class="btn !py-2 !px-3 text-sm" data-add="s1">Agregar</button>
            </div>
          </div>
        </div>
      </article>

      <!-- Bebida -->
      <article class="group card data-[hidden=true]:hidden" data-category="bebidas" data-id="d1">
        <div class="relative h-60 sm:h-64">
          <img src="img/refresco-demo.jpeg" alt="Coca-Cola 500 ml fr√≠a" class="w-full h-full object-cover">
          <div class="img-grad absolute inset-0"></div>
          <div class="absolute bottom-3 left-3 right-3">
            <h3 class="text-xl font-extrabold title-yellow">Coca-Cola 500 ml</h3>
            <p class="muted text-sm">Botella bien fr√≠a</p>
            <div class="mt-2 flex items-center justify-between">
              <span class="text-lg font-bold text-white">$1.500</span>
              <button class="btn !py-2 !px-3 text-sm" data-add="d1">Agregar</button>
            </div>
          </div>
        </div>
      </article>

      <!-- Cheesecake -->
      <article class="group card data-[hidden=true]:hidden" data-category="postres" data-id="ds1">
        <div class="relative h-60 sm:h-64">
          <img src="img/postre-demo.jpeg" alt="Cheesecake con frutos rojos" class="w-full h-full object-cover">
          <div class="img-grad absolute inset-0"></div>
          <div class="absolute bottom-3 left-3 right-3">
            <h3 class="text-xl font-extrabold title-yellow">Cheesecake</h3>
            <p class="muted text-sm">Frutos rojos y base crocante</p>
            <div class="mt-2 flex items-center justify-between">
              <span class="text-lg font-bold text-white">$3.100</span>
              <button class="btn !py-2 !px-3 text-sm" data-add="ds1">Agregar</button>
            </div>
          </div>
        </div>
      </article>

    </section>

    <!-- C√ìMO FUNCIONA (breve) -->
    <section id="como-funciona" class="mt-12 grid md:grid-cols-3 gap-6">
      <div class="p-5 panel rounded-2xl"><h4 class="font-extrabold title-yellow">1) Configur√°</h4><p class="text-sm muted">Eleg√≠ tama√±o, punto de cocci√≥n y extras.</p></div>
      <div class="p-5 panel rounded-2xl"><h4 class="font-extrabold title-yellow">2) Sum√° combos</h4><p class="text-sm muted">Upsells en un toque (papas + bebida).</p></div>
      <div class="p-5 panel rounded-2xl"><h4 class="font-extrabold title-yellow">3) WhatsApp</h4><p class="text-sm muted">El pedido llega con detalle listo.</p></div>
    </section>
  </main>

  <!-- STICKY CART -->
  <div id="stickyCart" class="fixed inset-x-0 bottom-0 z-50 border-t" style="background:rgba(20,21,24,.98); border-color:var(--border); box-shadow:var(--shadow);">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between gap-3">
      <button id="openCart" class="flex-1 btn-outline">Ver carrito (<span id="cartCount">0</span>)</button>
      <button id="checkout" class="btn flex-1">Confirmar por WhatsApp</button>
    </div>
  </div>

  <!-- DRAWER CARRITO -->
  <div id="drawer" class="fixed inset-0 z-[60] hidden">
    <div class="absolute inset-0 bg-black/60" data-close></div>
    <aside class="absolute right-0 top-0 h-full w-full sm:w-[440px] panel p-5 overflow-y-auto border-l" style="border-color:var(--border);">
      <div class="flex items-center justify-between">
        <h3 class="text-xl font-extrabold title-yellow">Tu pedido</h3>
        <button class="btn-outline" data-close>Cerrar</button>
      </div>
      <ul id="cartList" class="mt-4 space-y-4"></ul>
      <div class="mt-6 divider pt-4 grid grid-cols-2 gap-2 items-center">
        <div class="font-extrabold">Total</div>
        <div id="cartTotal" class="text-lg font-extrabold text-right">$0</div>
        <input id="clienteNombre" class="border rounded-xl px-3 py-2 col-span-2" placeholder="Tu nombre" style="background:#0b0c0e; border-color:var(--border); color:var(--text);" />
        <select id="clienteModo" class="border rounded-xl px-3 py-2" style="background:#0b0c0e; border-color:var(--border); color:var(--text);">
          <option value="Retiro">Retiro</option>
          <option value="Delivery">Delivery</option>
        </select>
        <input id="clienteHora" class="border rounded-xl px-3 py-2" placeholder="Hora estimada (ej: 20:30)" style="background:#0b0c0e; border-color:var(--border); color:var(--text);" />
      </div>
      <button id="checkout2" class="btn w-full mt-4">Enviar por WhatsApp</button>
      <p class="text-xs" style="color:var(--muted);">*Demo: precios e im√°genes ilustrativas.</p>
    </aside>
  </div>

  <!-- MODAL CONFIGURACI√ìN PRODUCTO -->
  <dialog id="configModal" class="w-[95vw] max-w-xl p-0">
    <form method="dialog" class="p-0">
      <div class="p-4 border-b flex items-center justify-between" style="border-color:var(--border);">
        <div>
          <h3 id="cfgTitle" class="text-xl font-extrabold title-yellow">Configurar</h3>
          <p id="cfgDesc" class="text-sm muted">Personaliz√° tu pedido</p>
        </div>
        <button class="btn-outline" value="cancel">Cerrar</button>
      </div>
      <div class="p-4 space-y-5">
        <section>
          <h4 class="font-bold title-yellow">Tama√±o</h4>
          <div id="optSize" class="mt-2 flex flex-wrap gap-2"></div>
        </section>
        <section id="secDoneness" class="hidden">
          <h4 class="font-bold title-yellow">Punto de cocci√≥n</h4>
          <div id="optDoneness" class="mt-2 flex flex-wrap gap-2"></div>
        </section>
        <section>
          <h4 class="font-bold title-yellow">Extras</h4>
          <div id="optExtras" class="mt-2 flex flex-wrap gap-2"></div>
        </section>
        <div class="flex items-center justify-between">
          <div class="text-sm muted">Subtotal</div>
          <div id="cfgSubtotal" class="text-lg font-extrabold text-white">$0</div>
        </div>
        <div class="flex items-center justify-end gap-3">
          <button class="btn-outline" value="cancel">Cancelar</button>
          <button id="cfgAddBtn" class="btn" value="default">Agregar</button>
        </div>
      </div>
    </form>
  </dialog>

  <!-- MODAL UPSELL / COMBO -->
  <dialog id="upsellModal" class="w-[95vw] max-w-md p-0">
    <form method="dialog" class="p-0">
      <div class="p-4 border-b flex items-center justify-between" style="border-color:var(--border);">
        <h3 class="text-xl font-extrabold title-yellow">Sum√° el Combo y ahorr√°</h3>
        <button class="btn-outline" value="close">Cerrar</button>
      </div>
      <div class="p-4 space-y-3">
        <p>üçü Papas + ü•§ Bebida a <span class="font-bold" style="color:var(--accent);">precio promo</span>.</p>
        <div class="flex items-center justify-between rounded-xl p-3" style="background:var(--panel-2); border:1px solid var(--border);">
          <div>
            <div class="font-bold">Combo Cl√°sico</div>
            <div class="text-sm muted">Papas medianas + Gaseosa 500</div>
          </div>
          <div class="text-right">
            <div class="line-through text-sm" style="color:#a5adba;">$2.900</div>
            <div class="text-lg font-extrabold" style="color:#22c55e;">$2.400</div>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-2">
          <button class="btn-outline" value="no">No gracias</button>
          <button id="upsellYes" class="btn" value="yes">Agregar combo</button>
        </div>
      </div>
    </form>
  </dialog>

  <!-- FOOTER -->
  <footer id="contacto" class="max-w-6xl mx-auto px-4 py-10 text-center text-sm muted">
    Demo Intermedio ‚Ä¢ Modificadores + Combos + WhatsApp ‚Ä¢ Hecho para antojar üòã
  </footer>

  <!-- ========= SCRIPTS ========= -->
  <script>
    // ======= CONFIG =======
    const BRAND_NAME = "Demo Restaurante Pro";
    const WHATSAPP_NUMBER = "5493751000000"; // Reemplazar por el del cliente
    const CURRENCY = "ARS";

    // ======= CAT√ÅLOGO (vinculado a las im√°genes que subiste) =======
    const CATALOG = {
      b1: {
        id:"b1", name:"Burger Doble Bacon", base:5200, category:"burgers",
        schedule:null, doneness:true,
        sizes:[ {name:"Simple",delta:-900},{name:"Doble",delta:0,default:true},{name:"Triple",delta:1200} ],
        extras:[ {name:"+Queso",price:400},{name:"+Bacon",price:600},{name:"+Huevo",price:300},{name:"Sin cebolla",price:0} ],
        upsell:{ bundleName:"Combo Cl√°sico", items:[{id:"s1",qty:1},{id:"d1",qty:1}], promoPrice:2400 }
      },
      p1: {
        id:"p1", name:"Pizza Muzzarella", base:6000, category:"pizzas",
        schedule:null, doneness:false,
        sizes:[ {name:"8 porciones",delta:0,default:true},{name:"12 porciones",delta:1800} ],
        extras:[ {name:"+Aceitunas extra",price:300},{name:"+Muzza extra",price:700},{name:"Mitad y mitad",price:500} ],
        upsell:null
      },
      m1: {
        id:"m1", name:"Milanesa Napolitana", base:6800, category:"milanesas",
        schedule:null, doneness:false,
        sizes:[ {name:"Sola",delta:0,default:true},{name:"Con guarnici√≥n",delta:900} ],
        extras:[ {name:"+Huevo frito",price:400},{name:"+Jam√≥n extra",price:600},{name:"+Queso extra",price:500} ],
        upsell:null
      },
      s1: {
        id:"s1", name:"Papas Cheddar", base:3400, category:"sides",
        schedule:null, doneness:false,
        sizes:[ {name:"Chicas",delta:-500},{name:"Medianas",delta:0,default:true},{name:"Grandes",delta:700} ],
        extras:[ {name:"+Bacon",price:600},{name:"+Verdeo extra",price:200} ],
        upsell:null
      },
      d1: {
        id:"d1", name:"Coca-Cola 500 ml", base:1500, category:"bebidas",
        schedule:null, doneness:false,
        sizes:[ {name:"350 ml",delta:-300},{name:"500 ml",delta:0,default:true},{name:"1 L",delta:900} ],
        extras:[ {name:"Sin hielo",price:0} ],
        upsell:null
      },
      ds1: {
        id:"ds1", name:"Cheesecake", base:3100, category:"postres",
        schedule:null, doneness:false,
        sizes:[ {name:"Porci√≥n",delta:0,default:true} ],
        extras:[ {name:"Salsa extra frutos rojos",price:300} ],
        upsell:null
      }
    };

    // ======= UTILS =======
    const fmt = (n) => new Intl.NumberFormat('es-AR',{style:'currency', currency:CURRENCY, maximumFractionDigits:0}).format(n);

    // ======= STATE =======
    const CART = { items:[], total:0 };

    // ======= CATEGOR√çAS (no filtramos por horario: siempre visibles) =======
    function applyCategory(cat){
      document.querySelectorAll('#grid article').forEach(card=>{
        const id = card.getAttribute('data-id');
        const prod = CATALOG[id];
        const okCat = (cat==='todo' || prod?.category===cat);
        card.dataset.hidden = okCat ? "false" : "true";
      });
      document.querySelectorAll('nav .pill').forEach(p=>p.classList.remove('active'));
      document.querySelector(`nav .pill[data-cat="${cat}"]`)?.classList.add('active');
    }
    document.querySelectorAll('nav [data-cat]').forEach(btn=>{
      btn.addEventListener('click', ()=> applyCategory(btn.getAttribute('data-cat')) );
    });
    applyCategory('todo');

    // ======= MODALES =======
    const configModal = document.getElementById('configModal');
    const upsellModal  = document.getElementById('upsellModal');
    let currentCfg = null, pendingUpsell = null;

    document.querySelectorAll('[data-config]').forEach(btn=>{
      btn.addEventListener('click', ()=> openConfig(btn.getAttribute('data-config')));
    });
    document.querySelectorAll('[data-add]').forEach(btn=>{
      btn.addEventListener('click', ()=> addConfiguredToCart({ id:btn.getAttribute('data-add'), size:null, doneness:null, extras:[] }));
    });

    function openConfig(id){
      const p = CATALOG[id]; if(!p) return;
      document.getElementById('cfgTitle').textContent = p.name;
      document.getElementById('cfgDesc').textContent  = "Personaliz√° tu pedido";

      const sizeWrap = document.getElementById('optSize'); sizeWrap.innerHTML="";
      p.sizes?.forEach(s=>{
        const el = document.createElement('button');
        el.type="button"; el.className="optchip"+(s.default?" active":"");
        el.textContent = s.name + (s.delta?` (${s.delta>0?"+":""}${fmt(s.delta)})`:"");
        el.onclick = ()=>{
          sizeWrap.querySelectorAll('.optchip').forEach(c=>c.classList.remove('active'));
          el.classList.add('active'); currentCfg.size = s; updateCfgSubtotal();
        };
        sizeWrap.appendChild(el);
      });

      const secDon = document.getElementById('secDoneness');
      const donWrap= document.getElementById('optDoneness'); donWrap.innerHTML="";
      if(p.doneness){
        secDon.classList.remove('hidden');
        ["Jugosa","A punto","Bien cocida"].forEach((d,idx)=>{
          const el=document.createElement('button');
          el.type="button"; el.className="optchip"+(idx===1?" active":"");
          el.textContent=d;
          el.onclick=()=>{ donWrap.querySelectorAll('.optchip').forEach(c=>c.classList.remove('active')); el.classList.add('active'); currentCfg.doneness=d; };
          donWrap.appendChild(el);
        });
      }else{ secDon.classList.add('hidden'); }

      const exWrap = document.getElementById('optExtras'); exWrap.innerHTML="";
      p.extras?.forEach(ex=>{
        const el=document.createElement('button');
        el.type="button"; el.className="optchip"; el.textContent = ex.name + (ex.price?` (${fmt(ex.price)})`:"");
        el.onclick=()=>{
          if(el.classList.contains('active')){
            el.classList.remove('active');
            currentCfg.extras = currentCfg.extras.filter(e=>e.name!==ex.name);
          }else{
            el.classList.add('active');
            currentCfg.extras.push(ex);
          }
          updateCfgSubtotal();
        };
        exWrap.appendChild(el);
      });

      currentCfg = { id, size: p.sizes?.find(s=>s.default) || p.sizes?.[0] || null, doneness: p.doneness ? "A punto" : null, extras: [] };
      updateCfgSubtotal();
      configModal.showModal();
    }

    function cfgPrice(){
      const p = CATALOG[currentCfg.id];
      let subtotal = p.base + (currentCfg.size?.delta || 0);
      currentCfg.extras.forEach(ex => subtotal += (ex.price||0));
      return subtotal;
    }
    function updateCfgSubtotal(){ document.getElementById('cfgSubtotal').textContent = fmt(cfgPrice()); }

    document.getElementById('cfgAddBtn').addEventListener('click',(e)=>{
      e.preventDefault();
      addConfiguredToCart(currentCfg);
      configModal.close();
      const prod = CATALOG[currentCfg.id];
      if(prod.upsell){ upsellModal.showModal(); pendingUpsell = prod.upsell; }
    });

    // ======= CARRITO =======
    const drawer = document.getElementById('drawer');
    document.getElementById('openCart').onclick = ()=>{ drawer.classList.remove('hidden'); };
    drawer.querySelectorAll('[data-close]').forEach(el => el.onclick = ()=> drawer.classList.add('hidden'));

    function addConfiguredToCart(cfg){
      const p = CATALOG[cfg.id]; if(!p) return;
      const price = p.base + (cfg.size?.delta || 0) + (cfg.extras||[]).reduce((a,b)=>a+(b.price||0),0);
      const key = JSON.stringify({ id:cfg.id, size:cfg.size?.name||null, doneness:cfg.doneness||null, extras:(cfg.extras||[]).map(e=>e.name).sort() });
      const idx = CART.items.findIndex(i => i.key===key);
      if(idx>-1){ CART.items[idx].qty++; } else {
        CART.items.push({
          key, id:cfg.id, name:p.name,
          detail:[
            cfg.size?.name?`Tama√±o: ${cfg.size.name}`:null,
            cfg.doneness?`Punto: ${cfg.doneness}`:null,
            (cfg.extras?.length?`Extras: ${cfg.extras.map(e=>e.name).join(", ")}`:null)
          ].filter(Boolean).join(" ‚Ä¢ "),
          unit:price, qty:1
        });
      }
      recalc(); pingCart();
    }

    function changeQty(key, delta){
      const idx = CART.items.findIndex(it => it.key===key);
      if(idx===-1) return;
      CART.items[idx].qty += delta;
      if(CART.items[idx].qty<=0){ CART.items.splice(idx,1); }
      recalc();
    }

    function recalc(){
      CART.total = CART.items.reduce((a,b)=>a + b.unit*b.qty, 0);
      document.getElementById('cartCount').textContent = CART.items.reduce((a,b)=>a+b.qty,0);
      document.getElementById('cartTotal').textContent = fmt(CART.total);
      renderList();
      window.__CART__ = { brand: BRAND_NAME, items: CART.items.map(i=>({ qty:i.qty, name:i.name, detail:i.detail, price:i.unit })), total: CART.total };
    }

    function renderList(){
      const ul = document.getElementById('cartList'); ul.innerHTML = '';
      if(CART.items.length===0){ ul.innerHTML = '<li style="color:var(--muted);">Tu carrito est√° vac√≠o.</li>'; return; }
      CART.items.forEach(i=>{
        const li = document.createElement('li');
        li.className = "grid grid-cols-[1fr_auto] gap-2";
        li.innerHTML = `
          <div>
            <div class="font-semibold title-yellow">${i.name}</div>
            ${i.detail ? `<div class="text-sm muted">${i.detail}</div>` : ""}
            <div class="text-sm muted">${fmt(i.unit)} c/u</div>
          </div>
          <div class="flex items-center gap-2 self-center">
            <button class="btn-outline !px-3 !py-1" data-dec='${i.key}'>-</button>
            <span class="w-6 text-center font-semibold">${i.qty}</span>
            <button class="btn-outline !px-3 !py-1" data-inc='${i.key}'>+</button>
          </div>
        `;
        ul.appendChild(li);
      });
      ul.querySelectorAll('[data-inc]').forEach(b=>b.onclick=()=>changeQty(b.getAttribute('data-inc'),+1));
      ul.querySelectorAll('[data-dec]').forEach(b=>b.onclick=()=>changeQty(b.getAttribute('data-dec'),-1));
    }

    // ======= UPSELL =======
    document.getElementById('upsellYes')?.addEventListener('click',(e)=>{
      e.preventDefault();
      if(!pendingUpsell) return;
      const { items, promoPrice, bundleName } = pendingUpsell;
      const key = "bundle:"+bundleName;
      const idx = CART.items.findIndex(i=>i.key===key);
      if(idx>-1){ CART.items[idx].qty++; } else {
        CART.items.push({ key, id:"bundle", name:bundleName, detail:"Incluye: Papas + Gaseosa", unit:promoPrice, qty:1 });
      }
      recalc(); upsellModal.close(); pendingUpsell = null;
    });

    // ======= WHATSAPP =======
    function buildOrderMessage(){
      const nombre = document.getElementById('clienteNombre')?.value || "‚Äî";
      const modo   = document.getElementById('clienteModo')?.value || "‚Äî";
      const hora   = document.getElementById('clienteHora')?.value || "‚Äî";
      const lines = CART.items.map(i => `- ${i.qty}√ó ${i.name}${i.detail?` (${i.detail})`:''} ‚Äî ${fmt(i.unit*i.qty)}`);
      const msg = [
        `Pedido ${BRAND_NAME}:`,
        ...lines,
        `Total estimado: ${fmt(CART.total)}`,
        `Nombre: ${nombre} | ${modo} | Hora: ${hora}`
      ].join("\n");
      return encodeURIComponent(msg);
    }
    function goWhatsApp(){
      if(CART.items.length===0){ alert("Tu carrito est√° vac√≠o."); return; }
      window.location.href = `https://wa.me/${WHATSAPP_NUMBER}?text=${buildOrderMessage()}`;
    }
    document.getElementById('checkout').onclick  = goWhatsApp;
    document.getElementById('checkout2').onclick = goWhatsApp;

    // Drawer overlay close
    document.querySelectorAll('#drawer [data-close]').forEach(el => el.onclick = ()=> drawer.classList.add('hidden'));

    // Ping UX
    function pingCart(){ const el = document.getElementById('stickyCart'); el.animate([{transform:'translateY(0)'},{transform:'translateY(-4px)'},{transform:'translateY(0)'}],{ duration:220, easing:'ease-out' }); }

    // INIT
    recalc();
  </script>
</body>
</html>
